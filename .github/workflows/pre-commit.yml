# SPDX-License-Identifier: Apache-2.0
# SPDX-FileCopyrightText: 2025 The Contributors to Eclipse OpenSOVD (see CONTRIBUTORS)
#
# See the NOTICE file(s) distributed with this work for additional
# information regarding copyright ownership.
#
# This program and the accompanying materials are made available under the
# terms of the Apache License Version 2.0 which is available at
# https://www.apache.org/licenses/LICENSE-2.0

name: 'OpenSOVD Pre-Commit Checks'

on:
  workflow_call:
    inputs:
      rust-nightly-version:
        description: 'Rust nightly version to use (YYYY-MM-DD), defaults to 2025-07-14 if not set'
        required: false
        type: string
        default: '2025-07-14'
      python-version:
        description: 'Python version to use for pre-commit environment'
        required: false
        type: string
        default: '3.13'
      config-path:
        description: >
          Path to a custom .pre-commit-config.yml in the consumer repository. If not provided, the action uses its own config.
        required: false
        type: string
        default: ''
      copyright-text:
        description: >
          Copyright holder text used by reuse annotate for new files. Defaults to "The Contributors to Eclipse OpenSOVD (see CONTRIBUTORS)".
        required: false
        type: string
        default: 'The Contributors to Eclipse OpenSOVD (see CONTRIBUTORS)'
      license:
        description: >
          SPDX license identifier used by reuse annotate for new files (e.g. "Apache-2.0"). Defaults to "Apache-2.0".
        required: false
        type: string
        default: 'Apache-2.0'
      reuse-template:
        description: >
          Name of the reuse Jinja2 template in .reuse/templates/ (without .jinja2 suffix). Consumer repos can provide their own template. Defaults to "opensovd".
        required: false
        type: string
        default: 'opensovd'

jobs:
  pre-commit-checks:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: false

      - name: Checkout ci/cd repository
        uses: actions/checkout@v4
        with:
          repository: eclipse-opensovd/cicd-workflows
          path: .cicd-workflows
          submodules: false

      - name: Run pre-commit action
        uses: ./.cicd-workflows/pre-commit-action
        with:
          rust-nightly-version: ${{ inputs.rust-nightly-version }}
          python-version: ${{ inputs.python-version }}
          config-path: ${{ inputs.config-path }}
          copyright-text: ${{ inputs.copyright-text }}
          license: ${{ inputs.license }}
          reuse-template: ${{ inputs.reuse-template }}
